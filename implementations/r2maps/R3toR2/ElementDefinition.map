map "http://hl7.org/fhir/StructureMap/ElementDefinition3to2" = "R3 to R2 Conversion for ElementDefinition"

uses "http://hl7.org/fhir/StructureDefinition/ElementDefinition" alias ElementDefinition as source
uses "http://hl7.org/fhir/DSTU2/StructureDefinition/ElementDefinition" alias ElementDefinitionR2 as target

imports "http://hl7.org/fhir/StructureMap/*3to2"

group for type+types  ElementDefinition extends Element
  input srcR : Resource as source
  input src : ElementDefinition as source
  input tgt : ElementDefinitionR2 as target

  "ElementDefinition-path" : for src.path make tgt.path
  "ElementDefinition-name" : for src.sliceName make tgt.name
  "ElementDefinition-representation" : for src.representation where $this = 'xmlAttr' make tgt.representation
  "ElementDefinition-label" : for src.label make tgt.label
  "ElementDefinition-code" : for src.code make tgt.code
  "ElementDefinition-slicing" : for src.slicing as vs0 make tgt.slicing as vt0 then {
    "ElementDefinition.slicing-discriminator" : for vs0.discriminator make vt0.discriminator
    "ElementDefinition.slicing-description" : for vs0.description make vt0.description
    "ElementDefinition.slicing-ordered" : for vs0.ordered make vt0.ordered
    "ElementDefinition.slicing-rules" : for vs0.rules make vt0.rules
  }

  "ElementDefinition-short" : for src.short make tgt.short
  "ElementDefinition-definition" : for src.definition make tgt.definition
  "ElementDefinition-comments" : for src.comments make tgt.comments
  "ElementDefinition-requirements" : for src.requirements make tgt.requirements
  "ElementDefinition-alias" : for src.alias make tgt.alias
  "ElementDefinition-min" : for src.min make tgt.min
  "ElementDefinition-max" : for src.max make tgt.max
  "ElementDefinition-base" : for src.base as vs0 make tgt.base as vt0 then {
    "ElementDefinition.base-path" : for vs0.path make vt0.path
    "ElementDefinition.base-min" : for vs0.min make vt0.min
    "ElementDefinition.base-max" : for vs0.max make vt0.max
  }

  "ElementDefinition-type" : for src.type as vs0 make tgt.type as vt0 then {
    "ElementDefinition.type-code" : for vs0.code make vt0.code
    "ElementDefinition.type-profile1" : for vs0.profile where vs0.targetProfile.empty() make vt0.profile
    "ElementDefinition.type-profile2" : for vs0.targetProfile make vt0.profile
    "ElementDefinition.type-aggregation" : for vs0.aggregation make vt0.aggregation
  }

  "ElementDefinition-type-1st" : for src where path.contains('.').not() and src.type.empty() and src.contentReference.empty() make tgt.type as vt0 then {
    "ElementDefinition.type-code" : for srcR.baseDefinition as base make vt0.code = (base.substring(40))
  }

  "ElementDefinition-contentReference" : for src.contentReference make tgt.nameReference
  "ElementDefinition-defaultValue" : for src.defaultValue make tgt.defaultValue
  "ElementDefinition-meaningWhenMissing" : for src.meaningWhenMissing make tgt.meaningWhenMissing
  "ElementDefinition-example" : for src.example first as exv then {
    "ElementDefinition-example-1" : for exv.value make tgt.example
  }
  "ElementDefinition-fixed" : for src.fixed make tgt.fixed
  "ElementDefinition-pattern" : for src.pattern make tgt.pattern
  "ElementDefinition-minValue" : for src.minValue make tgt.minValue
  "ElementDefinition-maxValue" : for src.maxValue make tgt.maxValue
  "ElementDefinition-maxLength" : for src.maxLength make tgt.maxLength
  "ElementDefinition-condition" : for src.condition make tgt.condition
  "ElementDefinition-constraint" : for src.constraint as vs0 make tgt.constraint as vt0 then {
    "ElementDefinition.constraint-key" : for vs0.key make vt0.key
    "ElementDefinition.constraint-requirements" : for vs0.requirements make vt0.requirements
    "ElementDefinition.constraint-severity" : for vs0.severity make vt0.severity
    "ElementDefinition.constraint-human" : for vs0.human make vt0.human
    "ElementDefinition.constraint-xpath" : for vs0.xpath make vt0.xpath
  }

  "ElementDefinition-mustSupport" : for src.mustSupport make tgt.mustSupport
  "ElementDefinition-isModifier" : for src.isModifier make tgt.isModifier
  "ElementDefinition-isSummary" : for src.isSummary make tgt.isSummary
  "ElementDefinition-binding" : for src.binding as vs0 make tgt.binding as vt0 then {
    "ElementDefinition.binding-strength" : for vs0.strength make vt0.strength
    "ElementDefinition.binding-description" : for vs0.description make vt0.description
    "ElementDefinition.binding-valueSet" : for vs0.valueSet make vt0.valueSet
  }

  "ElementDefinition-mapping" : for src.mapping as vs0 make tgt.mapping as vt0 then {
    "ElementDefinition.mapping-identity" : for vs0.identity make vt0.identity
    "ElementDefinition.mapping-language" : for vs0.language make vt0.language
    "ElementDefinition.mapping-map" : for vs0.map make vt0.map
  }


endgroup
