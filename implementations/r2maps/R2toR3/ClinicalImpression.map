map "http://hl7.org/fhir/StructureMap/ClinicalImpression2to3" = "R2 to R3 Conversions for ClinicalImpression"

uses "http://hl7.org/fhir/StructureDefinition/ClinicalImpression" as source
uses "http://hl7.org/fhir/StructureDefinition/ClinicalImpressionR2" as target
conceptmap "ClinicalImpressionStatus" {
  prefix s = "http://hl7.org/fhir/clinical-impression-status"
  prefix t = "http://hl7.org/fhir/clinical-impression-status"

  s:completed ~ t:draft
  s:completed ~ t:draft
  s:completed ~ t:draft
}


group ClinicalImpression extends Element
  input src : ClinicalImpressionR2 as source
  input tgt : ClinicalImpression as Target

  "ClinicalImpression-subject" : for src.patient as vs make tgt.subject as vt then Reference(vs,vt)
  "ClinicalImpression-assessor" : for src.assessor as vs make tgt.assessor as vt then Reference(vs,vt)
  "ClinicalImpression-status" : for src.status as v make tgt.status = translate(v, "#ClinicalImpressionStatus", "code")
  "ClinicalImpression-date" : for src.date as vs make tgt.date as vt then dateTime(vs, vt)
  "ClinicalImpression-description" : for src.description as vs make tgt.description as vt then string(vs, vt)
  "ClinicalImpression-previous" : for src.previous as vs make tgt.previous as vt then Reference(vs,vt)
  "ClinicalImpression-problem" : for src.problem as vs make tgt.problem as vt then Reference(vs,vt)
  "ClinicalImpression-protocol" : for src.protocol as vs make tgt.protocol as vt then uri(vs, vt)
  "ClinicalImpression-summary" : for src.summary as vs make tgt.summary as vt then string(vs, vt)
  "ClinicalImpression-finding" : for src.finding as vs0 make tgt.finding = as vt0 then {
    "ClinicalImpression.finding-item" : for vs0.item as vs make vt0.item as vt then CodeableConcept(vs,vt)
  }
  "ClinicalImpression-action" : for src.action as vs make tgt.action as vt then Reference(vs,vt)
endgroup

