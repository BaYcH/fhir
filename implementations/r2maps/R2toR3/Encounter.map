map "http://hl7.org/fhir/StructureMap/Encounter2to3" = "R2 to R3 Conversions for Encounter"

conceptmap "ActEncounterCode" {
  prefix s = "http://hl7.org/fhir/encounter-class"
  prefix t = "http://hl7.org/fhir/v3/ActCode"

  s:inpatient ~ t:AMB
  s:inpatient ~ t:AMB
  s:inpatient ~ t:AMB
  s:inpatient ~ t:AMB
  s:inpatient ~ t:AMB
  s:inpatient ~ t:AMB
  s:inpatient ~ t:AMB
  s:inpatient ~ t:AMB
}

uses "http://hl7.org/fhir/DSTU2/StructureDefinition/Encounter" alias EncounterR2 as source
uses "http://hl7.org/fhir/StructureDefinition/Encounter" alias Encounter as target

imports "http://hl7.org/fhir/StructureMap/primitives2to3"
imports "http://hl7.org/fhir/StructureMap/DomainResource2to3"
imports "http://hl7.org/fhir/StructureMap/Identifier2to3"
imports "http://hl7.org/fhir/StructureMap/Reference2to3"
imports "http://hl7.org/fhir/StructureMap/Period2to3"
imports "http://hl7.org/fhir/StructureMap/Duration2to3"
imports "http://hl7.org/fhir/StructureMap/CodeableConcept2to3"

group for type+types  Encounter extends DomainResource
  input src : EncounterR2 as source
  input tgt : Encounter as target

  "Encounter-identifier" : for src.identifier make tgt.identifier
  "Encounter-status" : for src.status make tgt.status
  "Encounter-statusHistory" : for src.statusHistory as vs0 make tgt.statusHistory as vt0 then {
    "Encounter.statusHistory-status" : for vs0.status make vt0.status
    "Encounter.statusHistory-period" : for vs0.period make vt0.period
  }

  "Encounter-class" : for src.class as v make tgt.class = translate(v, "#ActEncounterCode", "code")
  "Encounter-type" : for src.type make tgt.type
  "Encounter-priority" : for src.priority make tgt.priority
  "Encounter-patient" : for src.patient make tgt.patient
  "Encounter-episodeOfCare" : for src.episodeOfCare make tgt.episodeOfCare
  "Encounter-incomingReferral" : for src.incomingReferral make tgt.incomingReferral
  "Encounter-participant" : for src.participant as vs0 make tgt.participant as vt0 then {
    "Encounter.participant-type" : for vs0.type make vt0.type
    "Encounter.participant-period" : for vs0.period make vt0.period
    "Encounter.participant-individual" : for vs0.individual make vt0.individual
  }

  "Encounter-appointment" : for src.appointment make tgt.appointment
  "Encounter-period" : for src.period make tgt.period
  "Encounter-length" : for src.length make tgt.length
  "Encounter-reason" : for src.reason make tgt.reason
  "Encounter-indication" : for src.indication make tgt.indication
  "Encounter-hospitalization" : for src.hospitalization as vs0 make tgt.hospitalization as vt0 then {
    "Encounter.hospitalization-preAdmissionIdentifier" : for vs0.preAdmissionIdentifier make vt0.preAdmissionIdentifier
    "Encounter.hospitalization-origin" : for vs0.origin make vt0.origin
    "Encounter.hospitalization-admitSource" : for vs0.admitSource make vt0.admitSource
    "Encounter.hospitalization-admittingDiagnosis" : for vs0.admittingDiagnosis make vt0.admittingDiagnosis
    "Encounter.hospitalization-reAdmission" : for vs0.reAdmission make vt0.reAdmission
    "Encounter.hospitalization-dietPreference" : for vs0.dietPreference make vt0.dietPreference
    "Encounter.hospitalization-specialCourtesy" : for vs0.specialCourtesy make vt0.specialCourtesy
    "Encounter.hospitalization-specialArrangement" : for vs0.specialArrangement make vt0.specialArrangement
    "Encounter.hospitalization-destination" : for vs0.destination make vt0.destination
    "Encounter.hospitalization-dischargeDisposition" : for vs0.dischargeDisposition make vt0.dischargeDisposition
    "Encounter.hospitalization-dischargeDiagnosis" : for vs0.dischargeDiagnosis make vt0.dischargeDiagnosis
  }

  "Encounter-location" : for src.location as vs0 make tgt.location as vt0 then {
    "Encounter.location-location" : for vs0.location make vt0.location
    "Encounter.location-status" : for vs0.status make vt0.status
    "Encounter.location-period" : for vs0.period make vt0.period
  }

  "Encounter-serviceProvider" : for src.serviceProvider make tgt.serviceProvider
  "Encounter-partOf" : for src.partOf make tgt.partOf

endgroup
