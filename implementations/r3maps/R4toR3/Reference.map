map "http://hl7.org/fhir/StructureMap/Reference4to3" = "R4 to R3 Conversion for Reference"


uses "http://hl7.org/fhir/StructureDefinition/Reference" alias Reference as source
uses "http://hl7.org/fhir/3.0/StructureDefinition/Reference" alias ReferenceR3 as target

imports "http://hl7.org/fhir/StructureMap/*4to3"



group for type+types Reference extends Element
  input src : Reference as source
  input tgt : ReferenceR3 as target

  "Reference.reference" : for src.reference make tgt.reference 
  "Reference.identifier" : for src.identifier make tgt.identifier 
  "Reference.display" : for src.display make tgt.display 
endgroup


group for types Canonical2Reference extends Element
  input src : canonical as source
  input tgt : ReferenceR3 as target

  "CanonicalReference.reference" : for src.value make tgt.reference 
  "CanonicalReference.display" : for src.extension as e where e.url = 'http://hl7.org/fhir/StructureDefinition/rendered-value' as vs then {
    "CanonicalReference.display2" : for e.value as v make tgt.value as v
  }
endgroup

