<?xml version="1.0" encoding="UTF-8"?>
<!--
Message
  segment : Segment 0..* {1 based}
  
Segment
  code : String
  element : Field 0..* {1 based}
  field(n) : Element; // exception if there is repeat

Field
  id : String // metadata 
  repeat : Element 0..* {1 based}
  
Element
  component : Component 0..* {1 based}
  value() : string; // simple field, if there is one
  
Component
  // choice of one or the other
  text : string;  //todo: xhtml
  subComponent : Component 0..* {1 based}
  value() : string; // simple field, if there is one
  
 
so, selecting the PID for the MRN:
1. Message.segment.where(code = 'PID').repeat[3].first.value()
2. Message.segment[2].field(3).value()
3. Message.segment.where(code = 'PID').repeat[3].where(component[4].value = 'MR').value()

3. Message.SegmentList().Single(x => x.Code == "PID").Element(1).Repeat(3).AsString
2. Message.Segment(2).Field(3).AsString;
3. Message.SegmentList().Single(x => x.Code == "PID").Element(1).Repeat(3).ComponentList.Where(x => x.AsString == "MR");

 
-->
<StructureDefinition xmlns="http://hl7.org/fhir" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir file:///C:/work/org.hl7.fhir/build/schema/fhir-single.xsd">
  <id value="logical"/>
  <url value="http://hl7.org/fhir/v2/StructureDefinition/Message"/>
  <name value="HL7 v2 Logical Model"/>
  <status value="draft"/>
  <publisher value="Health Level Seven International (FHIR Infrastructure)"/>
  <contact>
    <telecom>
      <system value="other"/>
      <value value="http://hl7.org/fhir"/>
    </telecom>
  </contact>
  <contact>
    <telecom>
      <system value="other"/>
      <value value="http://www.hl7.org/Special/committees/fiwg/index.cfm"/>
    </telecom>
  </contact>
  <date value="2016-08-25T13:46:22+10:00"/>
  <description value="Logical Model for Version 2"/>
  <requirements value="To support v2 -&gt; FHIR mapping and v2 validation"/>
  <fhirVersion value="1.7.0"/>
  <kind value="logical"/>
  <abstract value="false"/>
  <type value="Message"/>
  <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Element"/>
  <derivation value="specialization"/>
  <differential>
    <element id="Message">
      <path value="Message"/>
      <short value="A message or batch - standalone set of segments"/>
      <definition value="A set of segments - a message, or a batch. A segment always starts with a segment with code = MSH, where as a batch will haev the batch header first"/>
      <min value="0"/>
      <max value="1"/>
    </element>
    <element id="Message.segment">
      <path value="Message.segment"/>
      <short value="A segment - a list of fields"/>
      <definition value="A segment a code, with a list of fields"/>
      <min value="1"/>
      <max value="*"/>
      <type>
        <code value="Element"/>
      </type>
    </element>
    <element id="Message.segment.code">
      <path value="Message.segment.code"/>
      <short value="code that identifies the meaning of the segment"/>
      <definition value="A code that identifies the meaning of the segment - a reference to the structure (canonical url = http://hl7.org/fhir/v2/StructureDefinition/[code]"/>
      <min value="1"/>
      <max value="1"/>
      <type>
        <code value="string"/>
      </type>
      <maxLength value="3"/>
    </element>
    <element id="Message.segment.element">
      <path value="Message.segment.element"/>
      <short value="An item in an segment - known by it's offset in the segment (1 based)"/>
      <definition value="An item in an segment - known by it's offset in the segment"/>
      <min value="0"/>
      <max value="*"/>
      <type>
        <code value="http://hl7.org/fhir/v2/StructureDefinition/Component"/>
      </type>
    </element>
  </differential>
</StructureDefinition>
